<html>
  <head>
    <title>Adventtikalenterit 2017</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script>
  	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js" integrity="sha256-T0Vest3yCU7pafRw9r+settMBX6JkKN06dqBnpQ8d30=" crossorigin="anonymous"></script> -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>

  <style>
      .input-group {
        margin-top: 5px;
        margin-bottom: 5px;
      }

      .inputMargin {
        margin-top: 5px;
      }

      .custom-toggler .navbar-toggler-icon {
        background-image: url("data:image/svg+xml;charset=utf8,%3Csvg viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath stroke='white' stroke-width='2' stroke-linecap='round' stroke-miterlimit='10' d='M4 8h24M4 16h24M4 24h24'/%3E%3C/svg%3E");
      }
  </style>

  <body>
    <nav class="navbar navbar-dark navbar-expand-md" style="background-color: #2C378D;">
      <div style="max-width: 77%;">
        <span class="navbar-text" style="color: white;">Mankkaan Eräsusien adventtikalenterit 2017</span>
      </div>
      <button class="navbar-toggler custom-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation" style="border-color: white;">
          <span class="navbar-toggler-icon" style="color: white;"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarText">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="/index.html">Syötä tietoja<span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/ohjeet.html">Johtajaohje</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/ryhmat.html">Lisätyt muutokset</a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="container" style="margin-top: 20px; max-width: 720px;">
      <div class="row">

      <div class="col-xs-12 col-sm-12">

        <div id="formFail" class="alert alert-danger" role="alert" style="display: none;">
          <h4 class="alert-heading">Virhe!</h4>
          <p>Tarkista, että kentissä ei ole virheitä (viikkonumero ja kalentereiden määrä -kentät eivät saa sisältää mitään muita kuin numeroita).</p>
          <hr>
          <p class="mb-0">Jos ei siltikään onnistu, ota yhteyttä antti.vuorenmaa@erasudet.fi / puh. 050 5556005</p>
        </div>

        <form id="form">
          <h3>Syötä tietoja</h3>

          <div style="border: 1px solid #868E96; border-radius: 3px; padding: 6px 10px;">
            <p style="height: 15px;">Täyttäjän tiedot</p>
            <div class="input-group">
              <div class="input-group-addon" style="width: 40px;"><div class="text-center" style="width: 100%;"><i class="fa fa-user" aria-hidden="true"></i></div></div>
              <input type="text" class="form-control" id="fillerName" placeholder="Nimi">
            </div>

            <div class="input-group">
              <div class="input-group-addon text-center" style="width: 40px;"><div class="text-center" style="width: 100%;"><i class="fa fa-phone" aria-hidden="true"></i></div></div>
              <input type="text" class="form-control" id="fillerPhone" placeholder="Puhelinnumero">
            </div>

            <div class="input-group">
              <div class="input-group-addon text-center" style="width: 40px;"><div class="text-center" style="width: 100%;"><i class="fa fa-paw" aria-hidden="true"></i></div></div>
              <select class="custom-select" id="groupName" style="border-top-left-radius: 0px; border-bottom-left-radius: 0px; width: 100%">
                <option value="Ryhmä" disabled selected>Ryhmä</option>
                <option value="Sudenpennut" disabled>--- Sudenpennut ---</option>
                <option value="Koira">Koira</option>
                <option value="IlveksetTytöt">Ilvekset (tytöt)</option>
                <option value="IlveksetPojat">Ilvekset (pojat)</option>
                <option value="Puumat">Puumat</option>
                <option value="Seikkalijat" disabled>--- Seikkailjat ---</option>
                <option value="Lumikot">Lumikot</option>
                <option value="Sudet">Sudet</option>
                <option value="Nallekarkit">Nallekarkit</option>
                <option value="Tarpojat" disabled>--- Tarpojat ---</option>
                <option value="Harmaakarhut">Harmaakarhut</option>
                <option value="Saigat">Saigat</option>
                <option value="Puuppelit">Puuppelit</option>
                <option value="Johtajat">--- Johtajat ---</option>
              </select>
            </div>

            <div class="input-group">
              <div class="input-group-addon text-center" style="width: 40px;"><div class="text-center" style="width: 100%;"><i class="fa fa-calendar-o" aria-hidden="true"></i></div></div>
              <input type="text" class="form-control" id="week" placeholder="Viikko">
            </div>
          </div>

          <div style="border: 1px solid #868E96; border-radius: 3px; padding: 10px; margin-top: 10px;">
            <p style="height: 15px;">Myyjät</p>

            <div class="form-row" id="seller1">
              <div class="inputMargin col-12"><input id="sellerName1" class="form-control" type="text" placeholder="Nimi (etunimi sukunimi)"></div>
              <div class="inputMargin col-4"><input id="sold1" class="form-control" type="number" min="0" placeholder="Otti (kpl)"></div>
              <div class="inputMargin col-4"><input id="returned1" class="form-control" type="number" min="0" placeholder="Palautti (kpl)"></div>
              <div class="inputMargin col-4"><input id="paid1" class="form-control" type="number" placeholder="Maksoi (€)"></div>
            </div>

            <div class="btn btn-outline-secondary" style="margin-top: 10px;" id="addNew"><i class="fa fa-plus" aria-hidden="true"></i> Lisää uusi myyjä</div>
            <div class="btn btn-outline-success" style="margin-top: 10px;" id="submit">Lähetä</div>
          </div>

        </form>

        <div id="successAlert" class="alert alert-success" role="alert" style="display: none;">
          <h4 class="alert-heading">Woohoo!</h4>
          <p>Tapahtumat lisätty onnistuneesti</p>
          <hr>
          <p class="mb-0">Mikäli syötit jotain väärin tai on muuta kysyttävää kalentereista, ota yhteyttä antti.vuorenmaa@erasudet.fi / puh. 050 5556005</p>
        </div>
        </div>

      </div>
    </div>


  </body>

  <script>

  // FILL WEEK NUMBER AUTOMATICALLY --------------------------------------------

    function getWeekNumber(d) {
        // Copy date so don't modify original
        d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
        // Set to nearest Thursday: current date + 4 - current day number
        // Make Sunday's day number 7
        d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay()||7));
        // Get first day of year
        var yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
        // Calculate full weeks to nearest Thursday
        var weekNo = Math.ceil(( ( (d - yearStart) / 86400000) + 1)/7);
        // Return array of year and week number
        return weekNo;
    }

    $('#week').one("click", function() {
      var weekNumber = getWeekNumber(new Date());
      $('#week').val(weekNumber);
    })

// ADD MORE SELLER FIELDS ------------------------------------------------------

    var counter = 1;
    var counterSeller = 1;
    var seller = "#seller" + counterSeller;

    // console.log(seller);

    $("#addNew").on("click", function() {
      counter = counter + 1;
      // console.log("Counter: " + counter);

      $(seller).after('<div style="display:none; border-top: 1px solid #D9D9D9; margin-top: 10px; padding-top: 6px;" class="form-row" id="seller' + counter + '"><div class="inputMargin col-12"><input id="sellerName' + counter + '" class="form-control" type="text" placeholder="Nimi (sukunimi etunimi)"></div><div class="inputMargin col-4"><input id="sold' + counter + '" class="form-control" type="number" min="0" placeholder="Otti (kpl)"></div><div class="inputMargin col-4"><input id="returned' + counter + '" class="form-control" type="number" min="0" placeholder="Palautti (kpl)"></div><div class="inputMargin col-4"><input id="paid' + counter + '" class="form-control" type="number" min="0" placeholder="Maksoi (€)"></div></div>');

      counterSeller = counterSeller + 1;
      // console.log("counterSeller: " + counterSeller);
      seller = "#seller" + counterSeller;
      // console.log("seller: " + seller);

      $(seller).slideDown("fast");

    })

// SUBMIT FORM SCRIPT ----------------------------------------------------------

    $('#submit').on('click', function submit() {

        var nameArray = new Array();
        var takenArray = new Array();
        var returnedArray = new Array();
        var paidArray = new Array();

        for (var i = 1; i < counter + 1; i++) {

          var sellerName = "#sellerName" + i;
          var taken = "#sold" + i;
          var returned = "#returned" + i;
          var paid = "#paid" + i;

          nameArray.push($(sellerName).val());

          if ($(taken).val() === "") {
            takenArray.push("0")
          } else {
            takenArray.push($(taken).val());
          }

          if ($(returned).val() === "") {
            returnedArray.push("0")
          } else {
            returnedArray.push($(returned).val());
          }

          if ($(paid).val() === "") {
            paidArray.push("0")
          } else {
            paidArray.push($(paid).val());
          }
        }

        var JSONnameArray = JSON.stringify(nameArray);
        var JSONtakenArray = JSON.stringify(takenArray);
        var JSONreturnedArray = JSON.stringify(returnedArray);
        var JSONpaidArray = JSON.stringify(paidArray);

        // console.log("nameArray: " + JSONnameArray);
        // console.log("takenArray: " + JSONtakenArray);
        // console.log("returnedArray: " + JSONreturnedArray);
        // console.log("paidArray: " + JSONpaidArray);

        $.ajax({
          method: "POST",
          url: "back.php",
          data: {
            action: 'submit',
            fillerName: $('#fillerName').val(),
            fillerPhone: $('#fillerPhone').val(),
            groupName: $('#groupName').val(),
            week: $('#week').val(),
            names: JSONnameArray,
            taken: JSONtakenArray,
            returned: JSONreturnedArray,
            paid: JSONpaidArray},
          success: function(data) {
              if (data == 'success') {
                $('#form').slideUp('slow');
                $('#successAlert').fadeIn('slow');
              } else
                $('#formFail').slideDown('slow');
                // console.log(data);
              }
            });
          });

  </script>

</html>
